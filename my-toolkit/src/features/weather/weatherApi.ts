import { createApi, fetchBaseQuery } from "@reduxjs/toolkit/query/react";
import type { WeatherResponse } from "./types/types";

const apiKey = "3603bb385cba1812ea388450e7b58c94";

export const weatherApi = createApi({
    reducerPath: "weatherApi",
    baseQuery: fetchBaseQuery({
        baseUrl: "https://api.openweathermap.org/data/2.5/",
    }),
//   –í —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç RTK Query –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è —Å—Ç—Ä–æ–∏—Ç –æ–±—ä–µ–∫—Ç API, –∫–æ—Ç–æ—Ä—ã–π:
//  —Ö—Ä–∞–Ω–∏—Ç —Ä–µ–¥—å—é—Å–µ—Ä
//  —Å–æ–∑–¥–∞—ë—Ç middleware
//  –≥–æ—Ç–æ–≤–∏—Ç –∫–µ—à
// –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ö—É–∫–∏ (–í–ê–ñ–ù–û!)
    endpoints:(builder) => ({
        getWeather:builder.query<WeatherResponse, string>({
        // RTK Query –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —Ö—É–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º:
        // use + –Ω–∞–∑–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ + Query
        // useGetWeatherQuery
            query: (city) => 
            `weather?q=${city}&appid=${apiKey}&units=metric`    
        }),
    })
});
export const { useGetWeatherQuery } = weatherApi


// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ‚Üí dispatch(action) ‚Üí —Ä–µ–¥—å—é—Å–µ—Ä

// üü© 1. RTK (Redux Toolkit) ‚Äî –∫–æ–≥–¥–∞ –ø–∏—à–µ–º –≤—Å—ë –≤—Ä—É—á–Ω—É—é

// –ò—Å–ø–æ–ª—å–∑—É–µ–º:

// createSlice

// createAsyncThunk

// extraReducers

// dispatch

// useSelector

// –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

// –°–æ–∑–¥–∞—ë–º asyncThunk –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞

// –î–µ–ª–∞–µ–º axios.get –≤–Ω—É—Ç—Ä–∏

// –ü—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º loading / error / data –≤—Ä—É—á–Ω—É—é

// –°–æ–∑–¥–∞—ë–º slice –∏ —Ä–µ–¥—å—é—Å–µ—Ä

// –û–ø–∏—Å—ã–≤–∞–µ–º extraReducers

// –í—ã–∑—ã–≤–∞–µ–º dispatch(fetchWeather())

// –ß–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Redux —á–µ—Ä–µ–∑ useSelector

// –ú–∏–Ω—É—Å—ã:

// üö´ –ú–Ω–æ–≥–æ –∫–æ–¥–∞

// üö´ –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å—Ç–µ–π—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏, –æ—à–∏–±–æ–∫

// üö´ –ù—É–∂–Ω–æ —Å–∞–º–æ–º—É —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–µ—à–µ–º

// üö´ –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ ‚Äî extraReducers

// üö´ –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –≤—ã–∑—ã–≤–∞—Ç—å dispatch

// –ü–ª—é—Å—ã:

// ‚úî –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å

// ‚úî –ü–æ–Ω—è—Ç–µ–Ω –Ω–æ–≤–∏—á–∫–∞–º (–ø–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)

// ‚úî –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –Ω–µ-API –∑–∞–¥–∞—á

// üü¶ 2. RTK Query ‚Äî –∫–æ–≥–¥–∞ –≤—Å—ë –¥–µ–ª–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

// –ò—Å–ø–æ–ª—å–∑—É–µ–º:

// createApi

// fetchBaseQuery

// builder.query

// –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Ö—É–∫–∏: useGetWeatherQuery, useLazyGetWeatherQuery

// –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

// –û–ø–∏—Å—ã–≤–∞–µ–º API –≤–Ω—É—Ç—Ä–∏ createApi

// RTK Query —Å–∞–º:

// –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å

// –∫—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

// –≤—ã–¥–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏

// —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—à–∏–±–∫—É

// –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ

// –ò–∑ weatherApi –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ö—É–∫ –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
// const { data, error, isLoading } = useGetWeatherQuery(city);

// –ò–ª–∏ –≤—Ä—É—á–Ω—É—é –ø–æ –∫–Ω–æ–ø–∫–µ:
// const [trigger, result] = useLazyGetWeatherQuery();
// trigger(city);

// –ü–ª—é—Å—ã:

// ‚úî –ù–∞ 70‚Äì90% –º–µ–Ω—å—à–µ –∫–æ–¥–∞

// ‚úî –ù–µ—Ç slice, thunk, extraReducers

// ‚úî –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö—É–∫–æ–≤

// ‚úî –ê–≤—Ç–æ–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

// ‚úî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ–µ—Ç—á

// ‚úî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É

// ‚úî –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫

// –ú–∏–Ω—É—Å—ã:

// ‚ö† –°—Ç—É–¥–µ–Ω—Ç—ã —Å–Ω–∞—á–∞–ª–∞ –ø—É—Ç–∞—é—Ç—Å—è –≤ skip, refetch, lazy

// ‚ö† –ù—É–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å middleware

// ‚ö† –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ Redux store